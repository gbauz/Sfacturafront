<form [formGroup]="productoForm"
      (ngSubmit)="onSubmit()"
      class="contenedor_formulario">

  <!-- CÓDIGO -->
  <p>Código</p>
  <mat-form-field appearance="outline" class="w-100">
    <mat-label>Ingrese el código</mat-label>
    <input matInput formControlName="codigo" maxlength="15" required>
    <mat-error *ngIf="codigo.invalid && (codigo.dirty || codigo.touched)">
      El código es obligatorio (máx. 15)
    </mat-error>
  </mat-form-field>

  <!-- NOMBRE -->
  <p>Nombre</p>
  <mat-form-field appearance="outline" class="w-100">
    <mat-label>Ingrese el nombre</mat-label>
    <input matInput formControlName="nombre" required>
    <mat-error *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)">
      El nombre es obligatorio
    </mat-error>
  </mat-form-field>

  <!-- PRECIO -->
  <p>Precio</p>
  <mat-form-field appearance="outline" class="w-100">
    <mat-label>Ingrese el precio</mat-label>
    <input matInput type="number" formControlName="precio" required>
    <mat-error *ngIf="precio.invalid && (precio.dirty || precio.touched)">
      Precio obligatorio y mayor a 0
    </mat-error>
  </mat-form-field>

  <!-- STOCK -->
  <p>Stock</p>
  <mat-form-field appearance="outline" class="w-100">
    <mat-label>Ingrese el stock</mat-label>
    <input matInput type="number" formControlName="stock" required>
    <mat-error *ngIf="stock.invalid && (stock.dirty || stock.touched)">
      Stock obligatorio (>= 0)
    </mat-error>
  </mat-form-field>

  <!-- BOTONES FORM -->
  <button mat-raised-button color="primary"
          type="submit"
          [disabled]="productoForm.invalid">
    {{ selectedProducto ? 'Editar' : 'Guardar' }}
  </button>

  <button *ngIf="selectedProducto"
          mat-stroked-button
          type="button"
          style="margin-left: 8px"
          (click)="cancelEdit()">
    Cancelar
  </button>

  <!-- TABLA -->
  <div class="table-container" style="margin-top: 16px;">
    <table mat-table [dataSource]="productosDataSource" class="mat-elevation-z1">

      <ng-container matColumnDef="id">
        <th mat-header-cell *matHeaderCellDef>ID</th>
        <td mat-cell *matCellDef="let e">{{ e.id }}</td>
      </ng-container>

      <ng-container matColumnDef="codigo">
        <th mat-header-cell *matHeaderCellDef>Código</th>
        <td mat-cell *matCellDef="let e">{{ e.codigo }}</td>
      </ng-container>

      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef>Nombre</th>
        <td mat-cell *matCellDef="let e">{{ e.nombre }}</td>
      </ng-container>

      <ng-container matColumnDef="precio">
        <th mat-header-cell *matHeaderCellDef>Precio</th>
        <td mat-cell *matCellDef="let e">{{ e.precio | number:'1.2-2' }}</td>
      </ng-container>

      <ng-container matColumnDef="stock">
        <th mat-header-cell *matHeaderCellDef>Stock</th>
        <td mat-cell *matCellDef="let e">{{ e.stock }}</td>
      </ng-container>

      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let e">
          <!-- ⚠️ type="button" ES CLAVE -->
          <button mat-icon-button
                  type="button"
                  (click)="editProducto(e)">
            <mat-icon>edit</mat-icon>
          </button>

          <button mat-icon-button
                  type="button"
                  (click)="deleteProducto(e.id)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</form>
